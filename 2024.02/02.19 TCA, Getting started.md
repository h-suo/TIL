# Today I Learned ğŸ¤“

> 2024.02.19 (ì›”)

## TCA

> TCA(The Composable Architecture)ëŠ” Composition, Testing ê·¸ë¦¬ê³  Ergonomicsì„ ê¸°ë°˜ìœ¼ë¡œ ì¼ê´€ë˜ê³  ì´í•´í•  ìˆ˜ ìˆëŠ” ë°©ì‹ìœ¼ë¡œ ì‘ìš© í”„ë¡œê·¸ë¨ì„ êµ¬ì¶•í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.

- **State**:
ê°„ë‹¨í•œ ê°’ íƒ€ì…ë“¤ë¡œ ì•±ì˜ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•, ìƒíƒœë¥¼ ê³µìœ ë¥¼ í†µí•´ í™”ë©´ì—ì„œ ì¼ì–´ë‚˜ëŠ” ë³€í™”ë¥¼ ë‹¤ë¥¸ í™”ë©´ì—ì„œ ì¦‰ì‹œ ê´€ì°°í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.
- **Composition**:
ê¸°ëŠ¥ì„ ì—¬ëŸ¬ ê°œì˜ ë…ë¦½ëœ ëª¨ë“ˆë¡œ ì¶”ì¶œí•˜ëŠ” ë°©ë²•, ëª¨ë“ˆì„ ë‹¤ì‹œ í•©ì³ì„œ ê±°ëŒ€í•œ ê¸°ëŠ¥ì„ ì‘ì€ ì»´í¬ë„ŒíŠ¸ì˜ ì§‘í•©ìœ¼ë¡œ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.
- **Side Effects**:
ì•± ë°”ê¹¥ì„¸ìƒê³¼ ì ‘ì´‰í•˜ëŠ” ì‘ì—…ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆê³  ì´í•´í•˜ê¸° ì‰½ê²Œ ì‘ì„±í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.
- **Testing**:
ì•„í‚¤í…ì²˜ ë‚´ë¶€ì˜ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ë¿ë§Œ ì•„ë‹ˆë¼ ì—¬ëŸ¬ íŒŒíŠ¸ë¡œ êµ¬ì„±ëœ ê¸°ëŠ¥ì˜ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ëŠ” ë°©ë²•, ì‚¬ì´ë“œ ì´í™íŠ¸ê°€ ì•±ì— ë¼ì¹˜ëŠ” ì˜í–¥ì— ëŒ€í•´ ì „ì²´ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.
- **Ergonomics**:
ìœ„ì˜ ë‚´ìš©ì„ ê°€ëŠ¥í•œ í•œ ì ì€ ê°œë…ì˜ ê°„ë‹¨í•œ APIë¡œ ì´ë£¨ëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

### ê¸°ë³¸ì ì¸ ì‚¬ìš©ë²•

TCAë¥¼ í†µí•´ ê¸°ëŠ¥ì„ ë§Œë“¤ê¸° ìœ„í•´ì„  ì—¬ëŸ¬ë¶„ì˜ ë„ë©”ì¸ì„ êµ¬ì„±í•˜ëŠ” ëª‡ ê°€ì§€ íƒ€ì…ì„ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

<Img src = "https://github.com/h-suo/TIL/assets/109963294/f27da10a-971d-46b5-8bf2-044ac4261a11" width="800"/>

- **State**:
ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•˜ê±°ë‚˜ UIë¥¼ ê·¸ë¦´ ë•Œ í•„ìš”í•œ ë°ì´í„°ì— ëŒ€í•œ ì„¤ëª…ì„ ë‚˜íƒ€ë‚´ëŠ” íƒ€ì…ì…ë‹ˆë‹¤.
- **Action**:
ì‚¬ìš©ìê°€ í•˜ëŠ” í–‰ë™ì´ë‚˜ ë…¸í‹°í”¼ì¼€ì´ì…˜ ë“± ì•±ì—ì„œ ìƒê¸¸ ìˆ˜ ìˆëŠ” ëª¨ë“  í–‰ë™ì„ ë‚˜íƒ€ë‚´ëŠ” íƒ€ì…ì…ë‹ˆë‹¤.
- **Environment**:
API í´ë¼ì´ì–¸íŠ¸ë‚˜ ì• ë„ë¦¬í‹±ìŠ¤ í´ë¼ì´ì–¸íŠ¸ì™€ ê°™ì´ ì•±ì´ í•„ìš”ë¡œ í•˜ëŠ” ì˜ì¡´ì„±(Dependency)ì„ ê°€ì§€ê³  ìˆëŠ” íƒ€ì…ì…ë‹ˆë‹¤.
- **Reducer**:
ì–´ë–¤ í–‰ë™ì´ ì£¼ì–´ì¡Œì„ ë•Œ ì§€ê¸ˆ ìƒíƒœë¥¼ ë‹¤ìŒ ìƒíƒœë¡œ ë³€í™”ì‹œí‚¤ëŠ” ë°©ë²•ì„ ê°€ì§€ê³  ìˆëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. ë˜í•œ ReducerëŠ” ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì´í™íŠ¸ë¥¼ ë°˜í™˜í•´ì•¼ í•˜ë©°, ë³´í†µì€ Effect ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
- **Store**:
ì‹¤ì œë¡œ ê¸°ëŠ¥ì´ ì‘ë™í•˜ëŠ” ê³µê°„ìœ¼ë¡œ, ìš°ë¦¬ëŠ” ì‚¬ìš©ì í–‰ë™ì„ ë³´ë‚´ì„œ ìŠ¤í† ì–´ëŠ” Reducerì™€ ì´í™íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê³ , ìŠ¤í† ì–´ì—ì„œ ì¼ì–´ë‚˜ëŠ” ìƒíƒœ ë³€í™”ë¥¼ ê´€ì¸¡í•´ì„œ UIë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

### ì˜ˆì‹œ ì½”ë“œ

ìˆ«ìë¥¼ ì¦ê°ì‹œí‚¤ëŠ” "+", "-" ë²„íŠ¼ê³¼ í•¨ê»˜ ìˆ«ìë¥¼ ë³´ì—¬ì£¼ëŠ” ë·° ë° íƒ­ í–ˆì„ ë•Œ ê·¸ ìˆ«ìì— ëŒ€í•œ ë¬´ì‘ìœ„ ì‚¬ì‹¤ì„ ê°€ì ¸ì˜¤ê³  ë·°ì— í‘œì‹œí•˜ê¸° ìœ„í•´ API Requestë¥¼ í•˜ëŠ” ë²„íŠ¼ì´ êµ¬í˜„ëœ ì½”ë“œì…ë‹ˆë‹¤.

**Feature**

ê¸°ëŠ¥ì˜ ë„ë©”ì¸ê³¼ ë™ì‘ì„ ìˆ˜ìš©í•  ìƒˆë¡œìš´ Featureë¥¼ ìƒì„±, @Reducer ë§¤í¬ë¡œë¥¼ ëª…ì‹œí•©ë‹ˆë‹¤.

```swift
import ComposableArchitecture

@Reducer
struct Feature {

}
```

**State**

UIë¥¼ ê·¸ë¦´ ë•Œ í•„ìš”í•œ Count ë° ìˆ«ìì— ëŒ€í•œ ì‚¬ì‹¤ì„ ë‚˜íƒ€ë‚´ëŠ” numberFactë¥¼ ì†ì„±ìœ¼ë¡œ ê°€ì§„ Stateë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

```swift
@Reducer
struct Feature {
  @ObservableState
  struct State: Equatable {
    var count = 0
    var numberFact: String?
  }
}
```

**Action**

ê¸°ëŠ¥ì˜ í–‰ë™ì„ ì •ì˜í•˜ê¸° ìœ„í•´ ì—´ê±°í˜•ìœ¼ë¡œ Actionì„ ì •ì˜í•©ë‹ˆë‹¤.

í–‰ë™ ìœ í˜•ì€ ê°ì†Œ, ì¦ê°€ ë° ì‚¬ì‹¤ ë²„íŠ¼ íƒ­ í•˜ê¸°ì™€ API Requestë¡œ ë°›ì•„ì˜¨ ì‘ë‹µì„ ì²˜ë¦¬ê°€ ìˆìŠµë‹ˆë‹¤.

```swift
@Reducer
struct Feature {
  @ObservableState
  struct State: Equatable { /* ... */ }
  enum Action {
    case decrementButtonTapped
    case incrementButtonTapped
    case numberFactButtonTapped
    case numberFactResponse(String)
  }
}
```

**Reducer**

bodyì— ê¸°ëŠ¥ì— ëŒ€í•œ ë¡œì§ê³¼ í–‰ë™ì„ êµ¬ì„±í•˜ëŠ” Reduceë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

Reduceë¼ëŠ” reducerë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” ë°©ë²•ê³¼ ì–´ë–¤ Effectë¥¼ ì‹¤í–‰í•  ê²ƒì¸ì§€ ì •ì˜í•©ë‹ˆë‹¤.

Effectë¥¼ ì‹¤í–‰í•  í•„ìš”ê°€ ì—†ì„ ê²½ìš° .noneì„ ë°˜í™˜í•©ë‹ˆë‹¤.

```swift
@Reducer
struct Feature {
  @ObservableState
  struct State: Equatable { /* ... */ }
  enum Action { /* ... */ }

  var body: some Reducer<State, Action> {
    Reduce { state, action in
      switch action {
      case .decrementButtonTapped:
        state.count -= 1
        return .none

      case .incrementButtonTapped:
        state.count += 1
        return .none

      case .numberFactButtonTapped:
        return .run { [count = state.count] send in
          let (data, _) = try await URLSession.shared.data(
            from: URL(string: "http://numbersapi.com/\(count)/trivia")!
          )
          await send(
            .numberFactResponse(String(decoding: data, as: UTF8.self))
          )
        }

      case let .numberFactResponse(fact):
        state.numberFact = fact
        return .none
      }
    }
  }
}
```

**View**

Viewì—ì„œëŠ” ìƒíƒœì˜ ëª¨ë“  ë³€ê²½ ì‚¬í•­ì„ ê´€ì°°í•˜ê³  ë‹¤ì‹œ ë Œë”ë§ í•  ìˆ˜ ìˆë„ë¡ storeì— ì˜ì¡´í•©ë‹ˆë‹¤.

```swift
struct FeatureView: View {
  let store: StoreOf<Feature>

  var body: some View {
    Form {
      Section {
        Text("\(store.count)")
        Button("Decrement") { store.send(.decrementButtonTapped) }
        Button("Increment") { store.send(.incrementButtonTapped) }
      }

      Section {
        Button("Number fact") { store.send(.numberFactButtonTapped) }
      }
      
      if let fact = store.numberFact {
        Text(fact)
      }
    }
  }
}
```

---
## ì°¸ê³  ë§í¬
- [GitHub: swift Composable Architecture](https://github.com/pointfreeco/swift-composable-architecture)
- [Composable Architecture Documentation: Getting started](https://pointfreeco.github.io/swift-composable-architecture/main/documentation/composablearchitecture/gettingstarted)
