# Today I Learned ğŸ¤“

> 2024.02.15 (ëª©)

## CFGetRetainCount(_:)

> Core Foundation ê°ì²´ì˜ ì°¸ì¡° ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
> 
> `iOS 2.0+` `iPadOS 2.0+` `macOS 10.0+`

```swift
func CFGetRetainCount(_ cf: CFTypeRef!) -> CFIndex
```

### ì–¸ì œ ì‚¬ìš©í• ê¹Œ?

CFTypeRefì˜ ì°¸ì¡° ìˆ˜ë¥¼ í™•ì¸í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
CFTypeRefëŠ” AnyObjectì˜ ë³„ì¹­ìœ¼ë¡œ Class íƒ€ì…ë§Œ ì°¸ì¡° ìˆ˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

EmptyClassë¼ëŠ” ì„ì˜ì˜ Classë¥¼ ë§Œë“¤ê³  CFGetRetainCountë¥¼ ì‚¬ìš©í•˜ì—¬ ì°¸ì¡° ìˆ˜ë¥¼ í™•ì¸í•˜ë©´ 2ê°€ ë°˜í™˜ì´ ë©ë‹ˆë‹¤. 
1ì´ ì•„ë‹Œ 2ê°€ ë°˜í™˜ë˜ëŠ” ì´ìœ ëŠ” CFGetRetainCountë¥¼ ì‚¬ìš©í•˜ëŠ” ìˆœê°„ í•¨ìˆ˜ì—ì„œë„ emptyClassë¥¼ ì°¸ì¡°í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

```swift
final class EmptyClass { }

let emptyClass = EmptyClass()

CFGetRetainCount(emptyClass)    // 2
```

### Retain Count í…ŒìŠ¤íŠ¸

ë‚´ë¶€ì— EmptyClassë¥¼ ê°€ì§€ê³  ìˆëŠ” TestStructì™€ TestClassì˜ ì°¸ì¡° ìˆ˜ê°€ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ CFGetRetainCountë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

```swift
struct TestStruct {
    let emptyClass = EmptyClass()
}

final class TestClass {
    let emptyClass = EmptyClass()
}
```

CFGetRetainCountëŠ” Classë§Œ íŒŒë¼ë¯¸í„°ë¡œ ë°›ê¸° ë•Œë¬¸ì— TestStruct ë‚´ë¶€ì˜ emptyClass í”„ë¡œí¼í‹°ì˜ ì°¸ì¡° ìˆ˜ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

StructëŠ” ê°’ì„ ë³µì‚¬í•˜ê¸° ë•Œë¬¸ì— testStructê°€ ë³µì‚¬ëœ ë§Œí¼ emptyClassì˜ ì°¸ì¡° ìˆ˜ëŠ” ì¦ê°€í•©ë‹ˆë‹¤. Structê°€ ë³µì‚¬ë˜ë©° ìƒˆë¡œìš´ emptyClassë¥¼ í• ë‹¹í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ì£¼ì†Œê°’ì„ ë³µì‚¬í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

```swift
let testStruct = TestStruct()
let testStruct2 = testStruct
let testStruct3 = testStruct

CFGetRetainCount(testStruct.emptyClass)    // 4
```

TestClassëŠ” ì°¸ì¡° íƒ€ì…ì´ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ë³€ìˆ˜ì— í• ë‹¹í•  ë•Œ ì£¼ì†Œ ê°’ì„ í• ë‹¹í•˜ì—¬ testClassì˜ ì°¸ì¡° ìˆ˜ê°€ ì¦ê°€í•˜ê²Œ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ TestStructì™€ ë‹¬ë¦¬ ì²˜ìŒ í• ë‹¹í•œ TestClassë¥¼ ì°¸ì¡°í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ë‚´ë¶€ì˜ emptyClassì˜ ì°¸ì¡° ìˆ˜ëŠ” ë³€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```swift
let testClass = TestClass()
let testClass2 = testClass
let testClass3 = testClass

CFGetRetainCount(testClass)               // 4
CFGetRetainCount(testClass.emptyClass)    // 2
```

---
## ì°¸ê³  ë§í¬
- [Apple Developer: CFGetRetainCount(_:)](https://developer.apple.com/documentation/corefoundation/1521288-cfgetretaincount)
- [Apple Developer: CFTypeRef](https://developer.apple.com/documentation/corefoundation/cftyperef)
