# Today I Learned ğŸ¤“

> 2024.04.09 (í™”)

## Async & Await

Async/AwaitëŠ” ê¸°ì¡´ Dispatch, completion handler ë³´ë‹¤ ë” ê°„ë‹¨íˆ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆëŠ” ë¬¸ë²•ì…ë‹ˆë‹¤.

### Refactoring with Async & Await

ìœ„ì¹˜ ì •ë³´ë¥¼ ë°›ì•„ì™€ ë‚ ì”¨ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ” ì—°ì‡„ì ì¸ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ completion handlerë¡œ í•˜ê²Œ ë˜ë©´ ì¤‘ì²© í´ë¡œì €ë¡œ ì¸í•´ ì½”ë“œì˜ ë³µì¡ì„±ì´ ì¦ê°€í•˜ê²Œ ë©ë‹ˆë‹¤.

ë˜í•œ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ëª¨ë“  handlerì—ì„œ ë°˜ë³µí•´ì„œ í•´ì•¼ í•©ë‹ˆë‹¤.

```swift
func loadLoation(_ localString: String, completion: @escaping (Result<Data, Error>) -> Void)
func loadWeatherData(_ locationData: Data, completion: @escaping (Result<Data, Error>) -> Void)
func decodeWeather(_ weatherData: Data, completion: @escaping (Result<weather, Error>) -> Void)
```

```swift
func fetchWeather(_ localString: String, completion: @escaping (Result<Weather, Error> -> Void)) {
    loadLoation(localString) { result in
        switch result {
        case let .success(data):
            loadWeatherData(data) { result in
                switch result {
                case let .success(data):
                    decodeWeather(data) { result in
                        switch result {
                        case let .success(weather):
                            completion(.success(weather))
                        case let .failure(error):
                            completion(.failure(error))
                        }
                    }
                case let .success(error):
                    completion(.failure(error))
                }
            }
        case let .failure(error):
            completion(.failure(error))
        }
    }
}
```

<br>

Async/Awaitë¡œ ë¦¬íŒ©í† ë§í•  ê²½ìš° ê°„ë‹¨íˆ ë¹„ë™ê¸° ë° ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
func loadLoation(_ localString: String) async throws -> Data
func loadWeatherData(_ locationData: Data) async throws -> Data
func decodeWeather(_ weatherData: Data) async throws -> Weather
```

```swift
func fetchWeather(_ localString: String) async throws -> Weather {
    let locationData  = try await loadLoation(localString)
    let weatherData = try await loadWeatherData(locationData)
    let weather      = try await decodeWeather(weatherData)
    return weather
}
```

<br>

### Async/Await ë‚´ë¶€ ë™ì‘

**ë™ê¸°**

fetchWeatherê°€ ì¼ë°˜ì ì¸ í•¨ìˆ˜ì²˜ëŸ¼ ë™ê¸° ì²˜ë¦¬ëœë‹¤ë©´ ìŠ¤ë ˆë“œì—ì„œ fetchWeather ë‚´ë¶€ì˜ loadLoation, loadWeatherData, decodeWeatherDataê°€ ëª¨ë‘ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦° í›„ì— ë‹¤ì‹œ ì œì–´ê¶Œì´ ë„˜ì–´ì™€ ì‹¤í–‰ë©ë‹ˆë‹¤.

<img src="https://github.com/h-suo/TIL/assets/109963294/5c11c8e1-38b5-4d2c-89a9-1545511aefe2" width="800">

**ë¹„ë™ê¸°**

fetchWeatherê°€ asyncë¡œ ë¹„ë™ê¸° ì²˜ë¦¬ëœë‹¤ë©´ ìŠ¤ë ˆë“œì—ì„œ fetchWeather ë‚´ë¶€ì˜ loadLoation, loadWeatherData, decodeWeatherDataë¥¼ ì‹¤í–‰í–ˆì„ ë•Œ asyncë¡œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ëŠ” ì œì–´ê¶Œì„ í¬ê¸°í•©ë‹ˆë‹¤.

ì´í›„ systemì—ì„œ ì œì–´ê¶Œì„ ê°€ì§€ê³  ë‹¤ë¥¸ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë‹¤ê°€ load ì‘ì—…ì´ ì™„ë£Œë˜ë©´ ë‹¤ì‹œ loadLoation, loadWeatherData, decodeWeatherDataë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

<img src="https://github.com/h-suo/TIL/assets/109963294/3343f05d-35f3-4cb1-a689-32d02a0dd4f7" width="800">

<br>

### Async/Await ì²˜ë¦¬

ìœ„ì—ì„œ êµ¬í˜„í•œ async í•¨ìˆ˜ë¥¼ ì²˜ë¦¬í•  ë•ŒëŠ” awaitë¥¼ ë¶™ì—¬ ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ë˜ëŠ” ê²ƒì„ ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤.

ë˜í•œ ë¹„ë™ê¸° ì‘ì—… ë‹¨ìœ„ì¸ Task ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸° ì‘ì—…ì„ ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.

```swift
func updateWeatherView() {
    Task {
        do {
            let weather = try await fetchWeather("korea")
            DispatchQueue.main.async {
                weatherView.update(with: weather)
            }
        } catch {
            print(error.localizedDescription)
        }
    }
}
```

---
## ì°¸ê³  ë§í¬
- [WWDC 2021: Use async/await with URLSession](https://developer.apple.com/videos/play/wwdc2021/10095/)
- [GitHub: swift-evolution/proposals/async-await](https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md#asyncawait)
