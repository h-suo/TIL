# Today I Learned ğŸ¤“

> 2024.03.21 (ëª©)

## Alert in TCA

TCAì—ì„œ Alertì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

### State

Alertì„ ì¶”ê°€í•˜ê¸° ìœ„í•´ì„œëŠ” ê°€ì¥ ë¨¼ì € Stateì— AlertStateë¥¼ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

AlertStateëŠ” ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ ìˆ˜ ìˆëŠ” Alertì˜ ìƒíƒœë¥¼ ì„¤ëª…í•˜ëŠ” ë°ì´í„° ìœ í˜•ìœ¼ë¡œ, ì•¡ì…˜ì€ Alertì˜ ë²„íŠ¼ì„ íƒ­ í•˜ì—¬ send í•  ìˆ˜ ìˆëŠ” ì•¡ì…˜ ìœ í˜•ì…ë‹ˆë‹¤.

```swift
@ObservableState
struct State: Equatable {
  @Presents var alert: AlertState<Action.Alert>?
}
```

<br>

### Action

Actionì— AlertStateê°€ send í•œ ì•¡ì…˜ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ alert() ì•¡ì…˜ê³¼ Alertì˜ ë²„íŠ¼ì„ íƒ­ í•˜ì—¬ send í•  Alert ì•¡ì…˜ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

ê°„ë‹¨í•œ ì—ëŸ¬ Alertì„ ë§Œë“¤ ê²ƒì´ê¸° ë•Œë¬¸ì— confirmErrorë§Œ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

```swift
enum Action {
  case alert(PresentationAction<Alert>)
  
  enum Alert: Equatable {
    case confirmError
  }
}
```

<br>

### Reducer

Reducerì—ì„œ AlertStateê°€ í• ë‹¹ë˜ëŠ” ë¡œì§ê³¼ Alert ì•¡ì…˜ì˜ ë¡œì§ì„ ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.

onAppear ì•¡ì…˜ì—ì„œ Dataë¥¼ ê°€ì ¸ì˜¤ëŠ” ì‘ì—…ì— ì‹¤íŒ¨í–ˆì„ ê²½ìš° ì—ëŸ¬ë¥¼ ì•Œë¦¬ëŠ” AlertStateë¥¼ í• ë‹¹í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  confirmErrorì„ êµ¬í˜„í•˜ì—¬ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ì²˜ë¦¬ ë¡œì§ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
var body: some Reducer<State, Action> {
  Reduce { state, action in
    switch action {
    case .onAppear:
      do {
        // Data Fetch Code
      } catch {
        state.alert = AlertState {
          TextState(error.localizedDescription)
        } actions: {
          ButtonState(role: .cancel, action: .confirmError) {
            TextState("OK")
          }
        }
      }
      return .none
    case .alert(.presented(.confirmError)):
      //  confirmError Handling Code
      state.alert = nil
      return .none
  }
  .ifLet(\.$alert, action: \.alert)
}
```

<br>

### View

Viewì—ì„œëŠ” Stateì˜ alertì´ í• ë‹¹ëì„ ë•Œ storeì˜ ìì‹ storeì¸ alertStateë¥¼ ë°˜í™˜í•˜ì—¬ alertì„ ë„ì›ë‹ˆë‹¤.

```swift
struct ContentView: View {
  
  @Bindable var store: StoreOf<Feature>
  
  var body: some View {
    NavigationStack {
      // View Code
    }
    .onAppear {
      store.send(.onAppear)
    }
    .alert($store.scope(state: \.alert, action: \.alert))
  }
}
```

---
## ì°¸ê³  ë§í¬
- [Composable Architecture Documentation: Multiple presentation destinations](https://pointfreeco.github.io/swift-composable-architecture/main/tutorials/composablearchitecture/02-02-multipledestinations/)
- [Composable Architecture Documentation: AlertState](https://pointfreeco.github.io/swift-composable-architecture/0.45.0/documentation/composablearchitecture/alertstate/)
- [Composable Architecture Documentation: scope(state:action:)](https://pointfreeco.github.io/swift-composable-architecture/0.45.0/documentation/composablearchitecture/store/scope(state:action:))
