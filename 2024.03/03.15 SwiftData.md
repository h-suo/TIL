# Today I Learned ğŸ¤“

> 2024.03.15 (ê¸ˆ)

## SwiftData

> ì½”ë“œë¥¼ ì´ìš©í•œ ë°ì´í„° ëª¨ë¸ ì„ ì–¸, ì§€ì† ê°€ëŠ¥í•œ ì €ì¥, ê´€ë¦¬ ë° ìë™ iCloud ë™ê¸°í™”ë¥¼ ì œê³µí•˜ëŠ” í”„ë ˆì„ì›Œí¬
> 
> `iOS 17.0+` `iPadOS 17.0+` `macOS 14.0+`

### ì–¸ì œ ì‚¬ìš©í• ê¹Œ?

ì•±ì— ì§€ì†ì„±ì„ ë¹ ë¥´ê²Œ ì¶”ê°€í•˜ê³  ì‹¶ì„ ë•Œ, SwiftDataë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœì†Œí•œì˜ ì½”ë“œì™€ ì™¸ë¶€ ì¢…ì†ì„± ì—†ì´ ì§€ì†ì„±ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br>

## Model()

> í´ë˜ìŠ¤ë¥¼ SwiftDataê°€ ê´€ë¦¬í•˜ëŠ” ì €ì¥ëœ ëª¨ë¸ë¡œ ë³€í™˜í•˜ê¸° ìœ„í•œ ë§¤í¬ë¡œ
> 
> `iOS 17.0+` `iPadOS 17.0+` `macOS 14.0+`

```swift
@attached(member, names: named(_$backingData), named(persistentBackingData), named(schemaMetadata), named(init), named(_$observationRegistrar), named(_SwiftDataNoType)) @attached(memberAttribute) @attached(extension, conformances: Observable, PersistentModel) macro Model()
```

### ì–¸ì œ ì‚¬ìš©í• ê¹Œ?

í´ë˜ìŠ¤ ê°ì²´ë¥¼ SwiftDataê°€ ê´€ë¦¬í•˜ëŠ” ëª¨ë¸ë¡œ ë³€í™˜í•˜ê³  ì‹¶ì„ ë•Œ Model() ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

PersistentModel ë° Observable í”„ë¡œí† ì½œì— ì í•©í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— êµ¬ì¡°ì²´ê°€ ì•„ë‹Œ í´ë˜ìŠ¤ ê°ì²´ì—ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
@Model
class TODO {
  var date: Date
  var title: String
  
  init(date: Date = Date(), title: String) {
    self.date = date
    self.title = title
  }
}
```

<br>

## Attribute(_:originalName:hashModifier:)

> ì†Œìœ  í´ë˜ìŠ¤ë¥¼ ê´€ë¦¬í•  ë•Œ SwiftDataê°€ ì†ì„±ì— ì‚¬ìš©ì ì§€ì • ë™ì‘ ì ìš©í•˜ê¸° ìœ„í•œ ë§¤í¬ë¡œ
> 
> `iOS 17.0+` `iPadOS 17.0+` `macOS 14.0+`

```swift
@attached(peer)
macro Attribute(
    _ options: Schema.Attribute.Option...,
    originalName: String? = nil,
    hashModifier: String? = nil
)
```

### íŒŒë¼ë¯¸í„°

- options: ë™ì‘ì„ ì‚¬ìš©ì ì •ì˜í•˜ê¸° ìœ„í•´ ì ìš©í•  ì˜µì…˜
- originalName: í˜„ì¬ ìŠ¤í‚¤ë§ˆ ë²„ì „ì˜ ê²ƒê³¼ ë‹¤ë¥´ë‹¤ë©´, ì†ì„±ì˜ ì´ì „ ì´ë¦„
- hashModifier: ì²¨ë¶€ëœ ì†ì„±ì˜ ìµœì‹  ë²„ì „ì„ ë‚˜íƒ€ë‚´ëŠ” ê³ ìœ í•œ í•´ì‹œ ê°’

### ì–¸ì œ ì‚¬ìš©í• ê¹Œ?

Model í´ë˜ìŠ¤ì˜ íŠ¹ì • ì†ì„±ì˜ ì§€ì†ì„± ë™ì‘ì„ ë³€ê²½í•´ì•¼ í•˜ëŠ” ê²½ìš°, @Attribute ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

TODO í´ë˜ìŠ¤ì˜ date ì†ì„±ì˜ ê°’ì— @Attribute(.unique)ë¥¼ ì‚¬ìš©í•˜ì—¬, ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ê³ ìœ í•˜ë‹¤ëŠ” ê²ƒì„ ì§€ì •í•˜ì—¬ ëª¨ë¸ ë°ì´í„°ì˜ ì¶©ëŒì„ í”¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
@Model
class TODO {
  @Attribute(.unique) var date: Date
  var title: String
  
  init(date: Date = Date(), title: String) {
    self.date = date
    self.title = title
  }
}
```

<br>

## Relationship(_:deleteRule:minimumModelCount:maximumModelCount:originalName:inverse:hashModifier:)

> SwiftDataê°€ ì†ì„±ì— ëª¨ë¸ ê°„ì˜ ê´€ê³„ë¡œ ê´€ë¦¬í•˜ëŠ” ë° í•„ìš”í•œ ì˜µì…˜ì„ ì§€ì •í•˜ê¸° ìœ„í•œ ë§¤í¬ë¡œ
> 
> `iOS 17.0+` `iPadOS 17.0+` `macOS 14.0+`

```swift
@attached(peer)
macro Relationship(
    _ options: Schema.Relationship.Option...,
    deleteRule: Schema.Relationship.DeleteRule = .nullify,
    minimumModelCount: Int? = 0,
    maximumModelCount: Int? = 0,
    originalName: String? = nil,
    inverse: AnyKeyPath? = nil,
    hashModifier: String? = nil
)
```

### íŒŒë¼ë¯¸í„°

- options: ë™ì‘ì„ ì‚¬ìš©ì ì •ì˜í•˜ê¸° ìœ„í•´ ì ìš©í•  ì˜µì…˜
- deleteRule: ê´€ê³„ì˜ ì§€ì†ì ì¸ ëª¨ë¸ì„ ì†Œìœ í•  ë•Œ ì ìš©í•  ê·œì¹™
- minimumModelCount: ê´€ê³„ê°€ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” ìµœì†Œ ëª¨ë¸ ìˆ˜
- maximumModelCount: ê´€ê³„ê°€ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ëª¨ë¸ ìˆ˜
- originalName: í˜„ì¬ ìŠ¤í‚¤ë§ˆ ë²„ì „ì˜ ê²ƒê³¼ ë‹¤ë¥´ë‹¤ë©´, ì†ì„±ì˜ ì´ì „ ì´ë¦„
- inverse: ì´ ê´€ê³„ì˜ ë°˜ëŒ€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê´€ê³„ì˜ í•µì‹¬ ê²½ë¡œ
- hashModifier: ì²¨ë¶€ëœ ì†ì„±ì˜ ìµœì‹  ë²„ì „ì„ ë‚˜íƒ€ë‚´ëŠ” ê³ ìœ í•œ í•´ì‹œ ê°’

### ì–¸ì œ ì‚¬ìš©í• ê¹Œ?

Model í´ë˜ìŠ¤ì˜ ì†ì„± ì¤‘ í•˜ë‚˜ ì´ìƒì´ í¬í•¨ëœ ëª¨ë¸ê³¼ ë‹¤ë¥¸ ëª¨ë¸ ê°„ì˜ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ì•¼ í•˜ëŠ” ê²½ìš°, @Relationship ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì—¬ SwiftDataëŠ” ê´€ë ¨ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ë©´ ë°œìƒí•˜ëŠ” ì¼ì„ í¬í•¨í•˜ì—¬ ëŸ°íƒ€ì„ì— ì´ëŸ¬í•œ ê´€ê³„ë¥¼ ì‹œí–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

TODOëŠ” TODOListì— ì†í•  ìˆ˜ ìˆìœ¼ë©°, TODOListsëŠ” TODO ë°°ì—´ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
@Model
class TODO {
  @Attribute(.unique) var date: Date
  @Relationship(inverse: \TODOList.todos) var todoList: TODOList?
  var title: String
  
  init(date: Date = Date(), title: String) {
    self.date = date
    self.title = title
  }
}

@Model
class TODOList {
  @Attribute(.unique) var name: String
  @Relationship var todos = [TODO]()
  
  init(name: String) {
    self.name = name
  }
}
```

<br>

## ModelContainer

> ì•±ì˜ ìŠ¤í‚¤ë§ˆì™€ ëª¨ë¸ ìŠ¤í† ë¦¬ì§€ configurationì„ ê´€ë¦¬í•˜ëŠ” ê°ì²´
> 
> `iOS 17.0+` `iPadOS 17.0+` `macOS 14.0+`

```swift
class ModelContainer
```

### ì–¸ì œ ì‚¬ìš©í• ê¹Œ?

Modelì„ ê°€ì ¸ì˜¤ê±°ë‚˜ ê´€ë¦¬í•˜ê³  ì‹¶ì„ ë•Œ, ModelContainerë¥¼ ì´ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.

ModelContainerëŠ” ModelContextì™€ ì•±ì˜ ê¸°ë³¸ ì˜êµ¬ ì €ì¥ì†Œ ì‚¬ì´ë¥¼ ì¤‘ì¬í•©ë‹ˆë‹¤. ê°€ì ¸ì˜¤ê¸°ë¥¼ ì‹¤í–‰í•˜ê±°ë‚˜ ModelContextì˜ save() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ë•Œë§ˆë‹¤, ModelContainerëŠ” ì œê³µí•˜ëŠ” ìŠ¤í‚¤ë§ˆì˜ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ë³¸ ë°ì´í„°ì˜ ì‹¤ì œ ì½ê¸° ë˜ëŠ” ì“°ê¸°ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì´ê²ƒì€ ì•±ì˜ ìì›ì„ ë³´í˜¸í•˜ê³  ì´ëŸ¬í•œ ì‘ì—…ì´ íš¨ìœ¨ì ì´ê³  ì¡°ì •ëœ ë°©ì‹ìœ¼ë¡œë§Œ ì´ë£¨ì–´ì§€ë„ë¡ í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.

```swift
@main
struct SwiftDataTestProjectApp: App {
  var body: some Scene {
    WindowGroup {
      ContentView()
    }
    .modelContainer(for: TODO.self)
  }
}

struct ContentView: View {
  @Query private var todos: [TODO]
  
  var body: some View {
    // View Code
  }
}
```

<br>

## ModelContext

> ëª¨ë¸ì„ ê°€ì ¸ì˜¤ê³ , ì‚½ì…í•˜ê³ , ì‚­ì œí•˜ê³ , ë””ìŠ¤í¬ì— ë³€ê²½ ì‚¬í•­ì„ ì €ì¥í•  ìˆ˜ ìˆëŠ” ê°ì²´
> 
> `iOS 17.0+` `iPadOS 17.0+` `macOS 14.0+`

```swift
class ModelContext
```

### ì–¸ì œ ì‚¬ìš©í• ê¹Œ?

Modelì„ ì‚½ì…, ì¶”ì  ë° ì‚­ì œë¥¼ í•˜ê³  ì‹¶ì„ ë•Œ ModelContextë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ModelContextëŠ” ì§€ì†ì ì¸ ëª¨ë¸ì˜ ì „ì²´ ìˆ˜ëª… ì£¼ê¸°ë¥¼ ê´€ë¦¬í•  ì±…ì„ì´ ìˆê¸° ë•Œë¬¸ì— SwiftDataì˜ í•µì‹¬ì…ë‹ˆë‹¤.

```swift
struct ContentView: View {  
  @Environment(\.modelContext) private var modelContext

  var body: some View {
    Button {
      let newTODO = TODO(title: "")
      modelContext.insert(newTODO)
    } label: {
      Text("Add TODO")
    }
  }
}
```

<br>

## Query()

> ì²¨ë¶€ëœ ëª¨ë¸ ìœ í˜•ì˜ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ë§¤í¬ë¡œ
> 
> `SwiftData` `SwiftUI` `iOS 17.0+` `iPadOS 17.0+` `macOS 14.0+`

```swift
@attached(accessor) @attached(peer, names: prefixed(`_`))
macro Query()
```

### ì–¸ì œ ì‚¬ìš©í• ê¹Œ?

ì²¨ë¶€ëœ ëª¨ë¸ ìœ í˜•ì˜ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ì ¸ì˜¤ê³  ì‹¶ì„ ë•Œ @Queryë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
struct ContentView: View {
  @Query private var todos: [TODO]
  
  var body: some View {
    // View Code
  }
}
```

---
## ì°¸ê³  ë§í¬
- [Apple Developer: SwiftData](https://developer.apple.com/documentation/swiftdata)
- [Apple Developer: Model()](https://developer.apple.com/documentation/swiftdata/model())
- [Apple Developer: Attribute(_:originalName:hashModifier:)](https://developer.apple.com/documentation/swiftdata/attribute(_:originalname:hashmodifier:))
- [Apple Developer: Relationship(_:deleteRule:minimumModelCount:maximumModelCount:originalName:inverse:hashModifier:)](https://developer.apple.com/documentation/swiftdata/relationship(_:deleterule:minimummodelcount:maximummodelcount:originalname:inverse:hashmodifier:))
- [Apple Developer: ModelContainer](https://developer.apple.com/documentation/swiftdata/modelcontainer)
- [Apple Developer: ModelContext](https://developer.apple.com/documentation/swiftdata/modelcontext)
- [Apple Developer: Query()](https://developer.apple.com/documentation/swiftdata/query())
