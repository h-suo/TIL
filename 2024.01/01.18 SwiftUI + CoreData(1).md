# Today I Learned ğŸ¤“

> 2024.01.18 (ëª©)

## SwiftUI + CoreData(1)

Project ì˜µì…˜ì„ SwiftUIì™€ Use CoreDataë¡œ ì„¤ì •í–ˆì„ ë•Œì˜ ì½”ë“œë¥¼ 2ê°œì˜ TILë¡œ ë‚˜ëˆ  ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

ì²« ë²ˆì§¸ TILì—ì„œëŠ” Persistenceì— ëŒ€í•´ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

### Persistence

Projectë¥¼ ìƒì„±í•˜ë©´ Interfaceë¥¼ UIKitìœ¼ë¡œ ì„¤ì •í–ˆì„ ë•Œì™€ ë‹¬ë¦¬ Persistenceë¼ëŠ” íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.

PersistenceControllerë¼ëŠ” Persistent Containerë¥¼ ì‰½ê²Œ ìƒì„±í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ì²´ê°€ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```swift
import CoreData

struct PersistenceController {
  static let shared: PersistenceController
  
  static var preview: PersistenceController
  
  let container: NSPersistentContainer
  
  init(inMemory: Bool = false)
}
```

#### shared

inMemory ì„¤ì •ì„ falseë¡œ ìƒì„±í•œ PersistenceControllerì´ë©°, ì‚¬ìš©ì ë¡œì»¬ì— ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” ê¸°ë³¸ì ì¸ PersistenceControllerì…ë‹ˆë‹¤.

```swift
static let shared = PersistenceController()
```

#### preview

inMemory ì„¤ì •ì„ trueë¡œ í•˜ì—¬ ë°ì´í„°ê°€ ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥ë˜ë„ë¡ ì„¤ì •í•˜ê³  10ê°œì˜ Itemì„ ìƒì„±í•´ë‘” PersistenceControllerì…ë‹ˆë‹¤.

SwiftUIë¡œ UI êµ¬í˜„ ì‹œ í”„ë¦¬ë·°ë¥¼ ìœ„í•´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
static var preview: PersistenceController = {
  let result = PersistenceController(inMemory: true)
  let viewContext = result.container.viewContext
  for _ in 0..<10 {
    let newItem = Item(context: viewContext)
    newItem.timestamp = Date()
  }
  do {
    try viewContext.save()
  } catch {
    let nsError = error as NSError
    fatalError("Unresolved error \(nsError), \(nsError.userInfo)")
  }
  return result
}()
```

#### init(inMemory:)

PersistenceControllerì˜ initializerì´ë©°, íŒŒë¼ë¯¸í„°ë¡œ inMemoryì˜ ì„¤ì • ì—¬ë¶€ë¥¼ ë°›ì•„ store Typeì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ containerë„ ì´ë•Œ ì´ˆê¸°í™”ë˜ë©°, automaticallyMergesChangesFromParentë¥¼ trueë¡œ ì„¤ì •í•˜ì—¬ ì €ì¥ì†Œ ì½”ë””ë„¤ì´í„° ë˜ëŠ” ë¶€ëª¨ ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ëœ ë³€ê²½ ì‚¬í•­ì„ ìë™ìœ¼ë¡œ ë³‘í•©í•©ë‹ˆë‹¤.

> Persistence Store Typeì— ëŒ€í•œ ì •ë¦¬ëŠ” ë‹¤ìŒ [TIL: Persistent Store Type](https://github.com/h-suo/TIL/blob/main/2023.09/09.12%20Persistent%20Store%20Type.md)ì„ í™•ì¸í•´ì£¼ì„¸ìš”.

```swift
init(inMemory: Bool = false) {
  container = NSPersistentContainer(name: "CoreDataTestProject_SwiftUI")
  if inMemory {
    container.persistentStoreDescriptions.first!.url = URL(fileURLWithPath: "/dev/null")
  }
  container.loadPersistentStores(completionHandler: { (storeDescription, error) in
    if let error = error as NSError? {
      fatalError("Unresolved error \(error), \(error.userInfo)")
    }
  })
  container.viewContext.automaticallyMergesChangesFromParent = true
}
```

---
## ì°¸ê³  ë§í¬
- [Apple Developer: automaticallyMergesChangesFromParent](https://developer.apple.com/documentation/coredata/nsmanagedobjectcontext/1845237-automaticallymergeschangesfrompa)
