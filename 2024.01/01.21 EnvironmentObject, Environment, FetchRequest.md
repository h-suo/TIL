# Today I Learned ğŸ¤“

> 2024.01.20 (í† )

## EnvironmentObject

> ë¶€ëª¨ ë˜ëŠ” ì¡°ìƒ ë·°ê°€ ì œê³µí•˜ëŠ” ObservableObjectì— ëŒ€í•œ Property Wrapper ìœ í˜•
> 
> `iOS 13.0+` `iPadOS 13.0+` `macOS 10.15+`

```swift
@frozen @propertyWrapper
struct EnvironmentObject<ObjectType> where ObjectType : ObservableObject
```

### ì–¸ì œ ì‚¬ìš©í• ê¹Œ?

EnvironmentObjectê°€ ë°”ë€Œë©´ í˜„ì¬ ë·°ì™€ ë¶€ëª¨ ë·°ê°€ ëª¨ë‘ ì—…ë°ì´íŠ¸ë˜ê¸° ë•Œë¬¸ì— ë·° ê°„ ë°ì´í„°ë¥¼ ê³µìœ í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ObservableObjectë¥¼ ì±„íƒí•œ DataModelì´ ìˆê³ , DataModelì„ StateObjectë¡œ ê°€ì§€ê³  ìˆëŠ” MyViewì—ì„œ SubViewì— EnvironmentObjectë¡œ DataModelì„ ë„˜ê²¨ì¤€ë‹¤ë©´, SubViewì—ì„œ DataModelì˜ Contentsë¥¼ ë³€ê²½í–ˆì„ ë•Œ MyViewì˜ Textë„ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.

```swift
final class DataModel: ObservableObject {
  @Published var contents: String
  
  init(contents: String) {
    self.contents = contents
  }
}

struct SubView: View {
  @EnvironmentObject
  var model: DataModel
  
  var body: some View {
    TextField("", text: $model.contents)
      .textFieldStyle(.roundedBorder)
      .padding()
  }
}

struct MyView: View {
  @StateObject
  var model = DataModel(contents: "contents")
  
  var body: some View {
    VStack {
      Text(model.contents)
      
      SubView()
        .environmentObject(model)
    }
  }
}
```

<br>

## Environment

> ë·° í™˜ê²½ì—ì„œ ê°’ì„ ì½ëŠ” Property Wrapper ìœ í˜•
> 
> `iOS 13.0+` `iPadOS 13.0+` `macOS 10.15+`

```swift
@frozen @propertyWrapper
struct Environment<Value>
```

### ì–¸ì œ ì‚¬ìš©í• ê¹Œ?

EnvironmentObjectê°€ ObservableObjectì— ëŒ€í•œ PropertyWrapperë¼ë©´, Observableì„ ì¤€ìˆ˜í•˜ê±°ë‚˜ ì‹œìŠ¤í…œì—ì„œ ì œê³µí•˜ëŠ” ê°ì²´ë¥¼ ë°›ê³  ì‹¶ì„ ë•Œ key Pathë¥¼ ì‚¬ìš©í•˜ì—¬ ì½ì„ ê°’ì„ í‘œì‹œí•˜ì—¬ ê°’ì„ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

EnvironmentValues key Pathì— managedObjectContextë¥¼ í‘œì‹œí•˜ì—¬, CoreDataì˜ NSManagedObjectContextë¥¼ ë°›ì•„ ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
@main
struct MyApp: App {
  let persistenceController = PersistenceController.shared
  
  var body: some Scene {
    WindowGroup {
      ContentView()
        .environment(\.managedObjectContext, persistenceController.container.viewContext)
    }
  }
}

struct ContentView: View {
  @Environment(\.managedObjectContext) private var viewContext
  
  var body: some View {
    // ...
  }
}
```

<br>

## FetchRequest

> CoreData Persistent Containerì—ì„œ entityë¥¼ ê²€ìƒ‰í•˜ëŠ” Property Wrapper ìœ í˜•
> 
> `iOS 13.0+` `iPadOS 13.0+` `macOS 10.15+`

```swift
@MainActor @propertyWrapper
struct FetchRequest<Result> where Result : NSFetchRequestResult
```

### ì–¸ì œ ì‚¬ìš©í• ê¹Œ?

SwiftUI Viewì—ì„œ CoreDataì˜ NSManagedObjectsë¥¼ ì œê³µë°›ê³  ì‹¶ì„ ë•Œ FetchRequestë¥¼ ì´ìš©í•´ sortDescriptorsì— ì •ë ¬ì„ ì›í•˜ëŠ” idë¥¼ key Pathì— ë„£ê³  ì •ë ¬í•˜ë„ë¡ ì„¤ì •ì„ í•˜ë©´, ìë™ìœ¼ë¡œ ì¶”ë¡ ëœ Entityì˜ FetchResultsë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Itemì´ë¼ëŠ” Entityë¥¼ timestampë¡œ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•˜ë„ë¡ sortDescriptorsë¥¼ ì„¤ì •í•˜ê³  FetchRequestë¥¼ ì‚¬ìš©í•˜ì—¬ Itemì˜ ì •ë ¬ì¸ itemsë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
struct ContentView: View {
  @FetchRequest(
    sortDescriptors: [NSSortDescriptor(keyPath: \Item.timestamp, ascending: true)],
    animation: .default)
  private var items: FetchedResults<Item>
  
  var body: some View {
    // ...
  }
}
```

---
## ì°¸ê³  ë§í¬
- [Apple Developer: EnvironmentObject](https://developer.apple.com/documentation/swiftui/environmentobject)
- [Apple Developer: Environment](https://developer.apple.com/documentation/swiftui/environment)
- [Apple Developer: FetchRequest](https://developer.apple.com/documentation/swiftui/fetchrequest)
